<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<project default="create_run_jar" name="Create Runnable Jar for Project tinyMediaManager with libraries in sub-folder">
	<!--this file was created by Eclipse Runnable JAR Export Wizard-->
	<!--ANT 1.7 is required                                        -->
	
	<!-- software revision number -->
	<property name="version" value="Beta"/>
	<buildnumber file="buildnumber.txt" />
	
	<target name="create_run_jar">
    <delete dir="build/lib" />
    <delete dir="build" />
    <mkdir dir="build" />
    <mkdir dir="build/lib" />
		<jar destfile="build/tmm.jar">
			<manifest>
				<attribute name="Main-Class" value="org.tinymediamanager.TinyMediaManager" />
				<attribute name="Class-Path" value=". lib/commons-lang3.jar lib/log4j.jar lib/themoviedbapi.jar lib/beansbinding.jar lib/jdom.jar lib/commons-codec.jar lib/commons-io.jar lib/jackson-core-lgpl.jar lib/jackson-mapper-lgpl.jar lib/objectdb.jar lib/Scaling-bin.jar lib/thetvdbapi.jar lib/forms.jar lib/JSplitButton.jar lib/commons-logging.jar lib/httpclient.jar lib/httpclient-cache.jar lib/httpcore.jar lib/httpmime.jar lib/JTattoo.jar" />
				<attribute name="SplashScreen-Image" value="org/tinymediamanager/ui/images/splashscreen.png" />
			</manifest>
			<fileset dir="bin" />
		</jar>
		<!-- <jar destfile="build/lib/resources.jar" basedir="resources" includes="*/**" /> -->
		<copy file="lib/commons-lang3.jar" todir="build/lib" />
		<copy file="lib/log4j.jar" todir="build/lib" />
		<copy file="lib/themoviedbapi.jar" todir="build/lib" />
		<copy file="lib/beansbinding.jar" todir="build/lib" />
		<copy file="lib/jdom.jar" todir="build/lib" />
		<copy file="lib/commons-codec.jar" todir="build/lib" />
		<copy file="lib/commons-io.jar" todir="build/lib" />
		<copy file="lib/jackson-core-lgpl.jar" todir="build/lib" />
		<copy file="lib/jackson-mapper-lgpl.jar" todir="build/lib" />
		<copy file="lib/objectdb.jar" todir="build/lib" />
		<copy file="lib/Scaling-bin.jar" todir="build/lib" />
		<copy file="lib/thetvdbapi.jar" todir="build/lib" />
		<copy file="lib/forms.jar" todir="build/lib" />
		<copy file="lib/JSplitButton.jar" todir="build/lib" />
		<copy file="lib/commons-logging.jar" todir="build/lib" />
		<copy file="lib/httpclient.jar" todir="build/lib" />
		<copy file="lib/httpclient-cache.jar" todir="build/lib" />
		<copy file="lib/httpcore.jar" todir="build/lib" />
		<copy file="lib/httpmime.jar" todir="build/lib" />
		<copy file="lib/JTattoo.jar" todir="build/lib" />
		
		<!-- buildinfo -->
    <propertyfile file="build/version"
               comment="This file is automatically generated - DO NOT EDIT">        
      <entry key="version" value="${version} - r${build.number}"/>
    </propertyfile>
	</target>

	<target name='package-app' depends='create_run_jar'>
		
    <!-- getdown -->
    <delete dir="dist/getdown/lib" />
    <delete dir="dist/getdown" />
    <mkdir dir="dist/getdown" />
    <mkdir dir="dist/getdown/lib" />
    <copy todir="dist/getdown/lib">
      <fileset dir="build/lib" includes="*" />
    </copy>
    <copy file="build/tmm.jar" todir="dist/getdown" />
    <copy file="build/version" todir="dist/getdown" />
    <copy file="AppBundler/getdown.txt" todir="dist/getdown" />
    <copy file="AppBundler/tmm.png" todir="dist/getdown" />
    <copy file="AppBundler/splashscreen.png" todir="dist/getdown" />
    <taskdef name="digest" classname="com.threerings.getdown.tools.DigesterTask"
             classpath="AppBundler/getdown-tools-1.2.jar"/>
    <digest appdir="dist/getdown"/>
		
		<!-- Mac OSX -->
		<taskdef name="jarbundler" classname="net.sourceforge.jarbundler.JarBundler" classpath="AppBundler/jarbundler-2.2.0.jar" />
		<jarbundler dir="dist/mac" name="tinyMediaManager" icon="AppBundler/tmm.icns" mainclass="com.threerings.getdown.launcher.Getdown" arguments="." 
      bundleid="org.tinyMediaManager.tinymediamanager" infostring="tinyMediaManager" jvmversion="1.6+" shortname="tMM" workingdirectory="$JAVAROOT" vmoptions="-Dapple.awt.graphics.UseQuartz=true">
      <jarfileset dir="AppBundler">
        <include name="**/getdown.jar" />
      	<include name="**/getdown.txt" />
      	<include name="**/splashscreen.png" />
      	<include name="**/tmm.png" />
      </jarfileset>
			
			<jarfileset dir="build">
			    <include name="**/*" />
			</jarfileset>
			
      <jarfileset dir="dist/getdown/">
          <include name="**/digest.txt" />
      </jarfileset>			

		</jarbundler>		
		<copy file ="AppBundler/JavaApplicationStub" todir="dist/mac/tinyMediaManager.app/Contents/MacOS" />
		
		<!-- Windows -->
		<property name="launch4j.dir" location="AppBundler/launch4j" />
		<taskdef name="launch4j" classname="net.sf.launch4j.ant.Launch4jTask"  classpath="${launch4j.dir}/launch4j.jar
		        :${launch4j.dir}/lib/xstream.jar" />
		<delete dir="dist/win/lib" />
		<delete dir="dist/win" />
		<mkdir dir="dist/win" />
		<mkdir dir="dist/win/lib" />
    <launch4j configFile="AppBundler/launch4j.xml" />
		<copy todir="dist/win/lib">
		  <fileset dir="build/lib" includes="*" />
		</copy>
		<copy file="build/tmm.jar" todir="dist/win" />
		<copy file="build/version" todir="dist/win" />
		<copy file="AppBundler/getdown.jar" todir="dist/win" />
		<copy file="AppBundler/getdown.txt" todir="dist/win" />
		<copy file="AppBundler/digest.txt" todir="dist/win" />
		<copy file="AppBundler/LICENSE" todir="dist/win" />
		<copy file="AppBundler/splashscreen.png" todir="dist/win" />
		<copy file="AppBundler/tmm.png" todir="dist/win" />
				
		<!-- Linux -->
		<delete dir="dist/linux/lib" />
    <delete dir="dist/linux" />
    <mkdir dir="dist/linux" />
		<mkdir dir="dist/linux/lib" />
    <copy todir="dist/linux/lib">
      <fileset dir="build/lib" includes="*" />
    </copy>
		<copy file="build/tmm.jar" todir="dist/linux" />
		<copy file="build/version" todir="dist/linux" />
		<copy file="AppBundler/getdown.jar" todir="dist/linux" />
		<copy file="AppBundler/getdown.txt" todir="dist/linux" />
		<copy file="AppBundler/digest.txt" todir="dist/linux" />
		<copy file="AppBundler/LICENSE" todir="dist/linux" />
		<copy file="AppBundler/tinyMediaManager.sh" todir="dist/linux" />
		<chmod file="dist/linux/tinyMediaManager.sh" perm="ugo+rx"/>
		<copy file="AppBundler/tmm.png" todir="dist/linux" />
		<copy file="AppBundler/splashscreen.png" todir="dist/linux" />
				
	</target>
	
</project>